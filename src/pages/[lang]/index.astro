---
/**
 * Dynamic homepage for all languages
 *
 * This file generates the homepage (calculator listing) for all languages
 * except English (which is in the root index.astro).
 *
 * URLs generated:
 * - /es/ (Spanish)
 * - /de/ (German)
 * - /fr/ (French)
 * - /pt/ (Portuguese)
 * - /hi/ (Hindi)
 * - /it/ (Italian)
 * - /pl/ (Polish)
 * - /nl/ (Dutch)
 * - /ru/ (Russian)
 * - /sv/ (Swedish)
 * - /tr/ (Turkish)
 */

import type { GetStaticPaths } from 'astro';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { t, calculatorPaths } from '@/utils/i18n';
import { getSupportedLocales, type Locale } from '@/config/languages';
import { getCategoryName } from '@/config/categories';

export const getStaticPaths = (async () => {
  const locales = getSupportedLocales();

  // Generate paths for all languages except English (default)
  return locales
    .filter(locale => locale !== 'en')
    .map(locale => ({
      params: { lang: locale },
      props: { locale }
    }));
}) satisfies GetStaticPaths;

const { locale } = Astro.props;
const lang = locale as Locale;

// Build calculators list dynamically for this language
const calculators = [
  { title: t('bmi.title', lang), description: t('bmi.description', lang), url: calculatorPaths.bmi[lang], category: getCategoryName('bmi', lang), icon: '‚öïÔ∏è' },
  { title: t('calorie.title', lang), description: t('calorie.description', lang), url: calculatorPaths.calorie[lang], category: getCategoryName('calorie', lang), icon: 'üî•' },
  { title: t('idealWeight.title', lang), description: t('idealWeight.description', lang), url: calculatorPaths.idealWeight[lang], category: getCategoryName('ideal-weight', lang), icon: 'üéØ' },
  { title: t('bodyFat.title', lang), description: t('bodyFat.description', lang), url: calculatorPaths.bodyFat[lang], category: getCategoryName('body-fat', lang), icon: 'üìä' },
  { title: t('bmr.title', lang), description: t('bmr.description', lang), url: calculatorPaths.bmr[lang], category: getCategoryName('bmr', lang), icon: '‚ö°' },
  { title: t('tdee.title', lang), description: t('tdee.description', lang), url: calculatorPaths.tdee[lang], category: getCategoryName('tdee', lang), icon: 'üí™' },
  { title: t('macro.title', lang), description: t('macro.description', lang), url: calculatorPaths.macro[lang], category: getCategoryName('macro', lang), icon: 'üçΩÔ∏è' },
  { title: t('pregnancy.title', lang), description: t('pregnancy.description', lang), url: calculatorPaths.pregnancy[lang], category: getCategoryName('pregnancy', lang), icon: 'ü§∞' },
  { title: t('pregnancyWeightGain.title', lang), description: t('pregnancyWeightGain.description', lang), url: calculatorPaths.pregnancyWeightGain[lang], category: getCategoryName('pregnancy-weight-gain', lang), icon: '‚öñÔ∏è' },
  { title: t('pregnancyConception.title', lang), description: t('pregnancyConception.description', lang), url: calculatorPaths.pregnancyConception[lang], category: getCategoryName('pregnancy-conception', lang), icon: 'üë∂' },
  { title: t('dueDate.title', lang), description: t('dueDate.description', lang), url: calculatorPaths.dueDate[lang], category: getCategoryName('due-date', lang), icon: 'üìÖ' },
  { title: t('pace.title', lang), description: t('pace.description', lang), url: calculatorPaths.pace[lang], category: getCategoryName('pace', lang), icon: 'üèÉ' },
  { title: t('armyBodyFat.title', lang), description: t('armyBodyFat.description', lang), url: calculatorPaths.armyBodyFat[lang], category: getCategoryName('army-body-fat', lang), icon: 'üéñÔ∏è' },
  { title: t('carbohydrate.title', lang), description: t('carbohydrate.description', lang), url: calculatorPaths.carbohydrate[lang], category: getCategoryName('carbohydrate', lang), icon: 'üçû' },
  { title: t('leanBodyMass.title', lang), description: t('leanBodyMass.description', lang), url: calculatorPaths.leanBodyMass[lang], category: getCategoryName('lean-body-mass', lang), icon: 'üí™' },
  { title: t('healthyWeight.title', lang), description: t('healthyWeight.description', lang), url: calculatorPaths.healthyWeight[lang], category: getCategoryName('healthy-weight', lang), icon: '‚úÖ' },
  { title: t('protein.title', lang), description: t('protein.description', lang), url: calculatorPaths.protein[lang], category: getCategoryName('protein', lang), icon: 'ü•©' },
  { title: t('bodyType.title', lang), description: t('bodyType.description', lang), url: calculatorPaths.bodyType[lang], category: getCategoryName('body-type', lang), icon: 'üßç' },
  { title: t('caloriesBurned.title', lang), description: t('caloriesBurned.description', lang), url: calculatorPaths.caloriesBurned[lang], category: getCategoryName('calories-burned', lang), icon: 'üî•' },
  { title: t('bsa.title', lang), description: t('bsa.description', lang), url: calculatorPaths.bsa[lang], category: getCategoryName('bsa', lang), icon: 'üìê' },
  { title: t('bloodType.title', lang), description: t('bloodType.description', lang), url: calculatorPaths.bloodType[lang], category: getCategoryName('blood-type', lang), icon: 'ü©∏' },
  { title: t('ovulation.title', lang), description: t('ovulation.description', lang), url: calculatorPaths.ovulation[lang], category: getCategoryName('ovulation', lang), icon: 'ü•ö' },
  { title: t('period.title', lang), description: t('period.description', lang), url: calculatorPaths.period[lang], category: getCategoryName('period', lang), icon: 'üìÖ' },
  { title: t('bodyFrame.title', lang), description: t('bodyFrame.description', lang), url: calculatorPaths.bodyFrame[lang], category: getCategoryName('body-frame', lang), icon: 'üìè' },
  { title: t('heartRate.title', lang), description: t('heartRate.description', lang), url: calculatorPaths.heartRate[lang], category: getCategoryName('heart-rate', lang), icon: 'üíó' },
  { title: t('waistHip.title', lang), description: t('waistHip.description', lang), url: calculatorPaths.waistHip[lang], category: getCategoryName('waist-hip', lang), icon: 'üìä' },
  { title: t('oneRepMax.title', lang), description: t('oneRepMax.description', lang), url: calculatorPaths.oneRepMax[lang], category: getCategoryName('one-rep-max', lang), icon: 'üí™' },
  { title: t('fatIntake.title', lang), description: t('fatIntake.description', lang), url: calculatorPaths.fatIntake[lang], category: getCategoryName('fat-intake', lang), icon: 'ü•ë' },
  { title: t('gfr.title', lang), description: t('gfr.description', lang), url: calculatorPaths.gfr[lang], category: getCategoryName('gfr', lang), icon: 'üè•' },
  { title: t('bac.title', lang), description: t('bac.description', lang), url: calculatorPaths.bac[lang], category: getCategoryName('bac', lang), icon: 'üç∫' },
  { title: t('weightWatchers.title', lang), description: t('weightWatchers.description', lang), url: calculatorPaths.weightWatchers[lang], category: getCategoryName('weight-watchers', lang), icon: '‚öñÔ∏è' },
  { title: t('age.title', lang), description: t('age.description', lang), url: calculatorPaths.age[lang], category: getCategoryName('age', lang), icon: 'üéÇ' },
  { title: t('date.title', lang), description: t('date.description', lang), url: calculatorPaths.date[lang], category: getCategoryName('date', lang), icon: 'üìÖ' },
  { title: t('percentage.title', lang), description: t('percentage.description', lang), url: calculatorPaths.percentage[lang], category: getCategoryName('percentage', lang), icon: 'üíØ' },
  { title: t('sleep.title', lang), description: t('sleep.description', lang), url: calculatorPaths.sleep[lang], category: getCategoryName('sleep', lang), icon: 'üò¥' },
  { title: t('tip.title', lang), description: t('tip.description', lang), url: calculatorPaths.tip[lang], category: getCategoryName('tip', lang), icon: 'üí∞' },
];
---

<BaseLayout
  title={t('site.title', lang)}
  description={t('site.description', lang)}
  lang={lang}
>
  <!-- Hero Section -->
  <div class="hero bg-gradient-to-b from-primary/5 to-base-100 py-16">
    <div class="hero-content text-center">
      <div class="max-w-3xl">
        <h1 class="text-5xl font-bold text-base-content mb-4">{t('site.title', lang)}</h1>
        <p class="text-xl text-base-content/70">{t('site.description', lang)}</p>
      </div>
    </div>
  </div>

  <!-- Calculators Section -->
  <div class="container mx-auto px-4 py-8">
    <section>
      <h2 class="text-3xl font-bold text-center mb-8">{t('common.featuredCalculators', lang) || 'Featured Calculators'}</h2>

      <!-- Search Box -->
      <div class="mb-8 max-w-2xl mx-auto">
        <input
          type="text"
          id="search"
          placeholder={t('common.search', lang)}
          autocomplete="off"
          class="input input-bordered w-full input-lg"
        />
      </div>

      <!-- Calculators Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="calculators-grid">
        {calculators.map((calc) => (
          <a href={calc.url} class="card bg-base-100 shadow-xl hover:shadow-2xl transition-all hover:-translate-y-1" data-title={calc.title.toLowerCase()} data-description={calc.description.toLowerCase()}>
            <div class="card-body">
              <div class="text-5xl mb-4">{calc.icon}</div>
              <h3 class="card-title text-lg">{calc.title}</h3>
              <p class="text-base-content/70 flex-grow">{calc.description}</p>
              <div class="card-actions justify-end">
                <span class="badge badge-primary badge-outline">{calc.category}</span>
              </div>
            </div>
          </a>
        ))}
      </div>

      <!-- No Results Message -->
      <p class="text-center py-12 text-base-content/50 text-lg" id="no-results" style="display: none;">
        {t('common.noResults', lang)}
      </p>
    </section>
  </div>

  <script>
    const searchInput = document.getElementById('search') as HTMLInputElement;
    const calculatorsGrid = document.getElementById('calculators-grid') as HTMLElement;
    const noResults = document.getElementById('no-results') as HTMLElement;
    const cards = Array.from(calculatorsGrid.querySelectorAll('.card'));

    searchInput?.addEventListener('input', (e) => {
      const searchTerm = (e.target as HTMLInputElement).value.toLowerCase();
      let visibleCount = 0;

      cards.forEach((card) => {
        const title = card.getAttribute('data-title') || '';
        const description = card.getAttribute('data-description') || '';
        const matches = title.includes(searchTerm) || description.includes(searchTerm);

        if (matches) {
          (card as HTMLElement).style.display = '';
          visibleCount++;
        } else {
          (card as HTMLElement).style.display = 'none';
        }
      });

      if (visibleCount === 0) {
        noResults.style.display = 'block';
      } else {
        noResults.style.display = 'none';
      }
    });
  </script>
</BaseLayout>
